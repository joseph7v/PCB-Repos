# ECE3400 Fall 2017
## Lab 2 TA Reference

1.  The TAs should start every lab with a brief introduction to what the students are supposed to do. Make sure everyone knows where the lab-instructions are located. Keep your intros brief so that everyone can get onto their work. 
2.  If the same question appears many times during a session, it is a good idea to ask everyone to pause their work, and discuss the questions with all four teams at the same time. 
3.  Near the end of the lab, when the first teams have started wrapping up, you should again address all the teams, and remind them to write up everything on their webpage, and what is needed to complete the next milestone. 

### Introduction
This lab is about interfacing and with and processing values from sensors. Specifically, it is about using the Arduino to preform a Fourier Transform on IR and Audio signals. Here are some talking points for the start of the lab, feel free to use as many or few of these talking points as you want.
* **Review Fourier Transforms:** Briefly go over how a Fourier Transform represents a signal in the frequency domain.  Describe the advantages of representing a signal in the frequency domain for signal processing purposes.  
* **What is an FFT?** Explain how an FFT is an algorithm for quickly calculating the Fourier transform of a signal. The Arduino represents a signal's Fourier coefficients by using "bins" which cover a range of frequencies
* **Sources of infrared noise:** Discuss sources of IR noise, such as the sun and fluorescent lights in the room. Explain the nature of this noise, does this noise have a frequency associated with it or is it constant magnitude?
* **Sources of audible noise:** Discuss the range frequencies that human voice covers. Discuss harmonics and how it might help them identify the sound of the whistle.
* **Different types of analog filters:** Review methods of analog filtering, such as low pass, high pass, and bandpass filters made with resistors/capacitors/inductors. Discuss the active filters and their advantage over passive filters, especially when dealing with low magnitude signals.
* **A/D conversion limitations:** Discuss the basic functionality of an A/D converter. Explain the constraints on an A/D converter such as resolution and sampling time. The built-in Arduino A/D converter has 10 bits of resolution and runs at approximately 9615 Hz when using analog read.
* **Different types of digital filters:** Explain the basic methods of digital filtering. Go over what the Nyquist frequency of a signal is and why it is important.
* **How phototransistors work:** Explain that light allows current to flow through a phototransistor. Describe how the gain of the transistor makes it more sensitive to light than a than a photodiode.
* **How the microphone works:** Briefly describe piezo-electric materials and how they are used to detect sound.

### Team materials
#### Microphone circuit
- 1 Arduino
- 1 µF capacitor
- 300 Ω resistors
- ~3 kΩ resistor
- 1 Op-Amp
- Various resistors/capacitors
#### Treasure detection circuit
- 1 Arduino
- 1 800nm phototransistors
- 300 Ω resistors
- 1 Treasure emitter
- 1 Op-Amp
- Various resistors/capacitors

#### Useful references
- [FFT library wiki](http://wiki.openmusiclabs.com/wiki/ArduinoFFT) (Has list of functions and some example code)
- [Sallen Key filter design](http://sim.okawa-denshi.jp/en/OPseikiLowkeisan.htm) (Useful for microphone circuit)
- [Active band-pass filter review](http://www.electronics-tutorials.ws/filter/filter_7.html)
- [Microphone and amplifier datasheets](https://learn.adafruit.com/adafruit-agc-electret-microphone-amplifier-max9814/downloads)
- [Phototransistor datasheet](http://rohmfs.rohm.com/en/products/databook/datasheet/opto/optical_sensor/photo_transistor/rpt-34pb3f.pdf)
- [LM358 Op-Amp datasheet](http://www.ti.com/lit/ds/symlink/lm358.pdf	)
- [LF353 Op-Amp datasheet](http://www.ti.com/lit/ds/symlink/lf353-n.pdf)

### Extra help
#### Microphone circuit
The microphone being used in this class is fairly susceptible to noise, so the use of a bandpass filter to isolate the signal from the whistle is highly recommended. Due to the low amplitude of signal, active filters are preferred. Students last year used [Sallen Key](http://sim.okawa-denshi.jp/en/OPseikiLowkeisan.htm) filters in order to better isolate the electrical signal generated by the whistle. Other filters, as well as digital signal processing, are encouraged, but the Sallen Key filter has been used in previous years by students to great success.
#### Using the FFT library
One of the disadvantages to the Arduino FFT library is its memory usage. Students last year often found the FFT library causing the Arduino to run out of memory during operation. The solution to this problem is to lower the number of bins, and therefore accuracy of FFT. The loss in accuracy can be made up for in part by adding more hardware dedicated to filtering the audio signal. Additionally, code may be optimized or shifted to the base station for further memory savings. 
#### IR circuit
One of the changes between this year and last year is emphasis on using the Arduino FFT to process the treasure signals. Last year, the most common approach to finding treasure frequency was to use an active filter to filter out the DC signal from the IR sensors, then greatly amplify the AC signal, such that it oscillated between a logical 1 and 0. Then this signal was piped to a pin on the Arduino that triggered an interrupt. The frequency of these interrupts was then calculated in software and used to determine frequency. Since the FFT on the Arduino only goes up to 9615Hz when using analog read, students may have to reconfigure the ADC to run faster and read from the ADC manually to interpret IR signals at 17kHz. Additionally, students could use hardware to divide the frequency of incoming IR signals by 2, then use the FFT to process those signals. All of these are potential solutions, and students are encouraged to experiment and find the solution that works best for them.
